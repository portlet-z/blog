## 1. 类文件结构

一个简单的HelloWorld.java

```java
package com.bytebuf.t2;

public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello world");
    }
}
```

执行`javac -parameters -d . HelloWorld.java`

编译为HelloWorld.class文件为：用`od -t xC HelloWorld.class`

```
0000000    ca  fe  ba  be  00  00  00  34  00  1f  0a  00  06  00  11  09
0000020    00  12  00  13  08  00  14  0a  00  15  00  16  07  00  17  07
0000040    00  18  01  00  06  3c  69  6e  69  74  3e  01  00  03  28  29
0000060    56  01  00  04  43  6f  64  65  01  00  0f  4c  69  6e  65  4e
0000100    75  6d  62  65  72  54  61  62  6c  65  01  00  04  6d  61  69
0000120    6e  01  00  16  28  5b  4c  6a  61  76  61  2f  6c  61  6e  67
0000140    2f  53  74  72  69  6e  67  3b  29  56  01  00  10  4d  65  74
0000160    68  6f  64  50  61  72  61  6d  65  74  65  72  73  01  00  04
0000200    61  72  67  73  01  00  0a  53  6f  75  72  63  65  46  69  6c
0000220    65  01  00  0f  48  65  6c  6c  6f  57  6f  72  6c  64  2e  6a
0000240    61  76  61  0c  00  07  00  08  07  00  19  0c  00  1a  00  1b
0000260    01  00  0b  48  65  6c  6c  6f  20  77  6f  72  6c  64  07  00
0000300    1c  0c  00  1d  00  1e  01  00  19  63  6f  6d  2f  62  79  74
0000320    65  62  75  66  2f  74  32  2f  48  65  6c  6c  6f  57  6f  72
0000340    6c  64  01  00  10  6a  61  76  61  2f  6c  61  6e  67  2f  4f
0000360    62  6a  65  63  74  01  00  10  6a  61  76  61  2f  6c  61  6e
0000400    67  2f  53  79  73  74  65  6d  01  00  03  6f  75  74  01  00
0000420    15  4c  6a  61  76  61  2f  69  6f  2f  50  72  69  6e  74  53
0000440    74  72  65  61  6d  3b  01  00  13  6a  61  76  61  2f  69  6f
0000460    2f  50  72  69  6e  74  53  74  72  65  61  6d  01  00  07  70
0000500    72  69  6e  74  6c  6e  01  00  15  28  4c  6a  61  76  61  2f
0000520    6c  61  6e  67  2f  53  74  72  69  6e  67  3b  29  56  00  21
0000540    00  05  00  06  00  00  00  00  00  02  00  01  00  07  00  08
0000560    00  01  00  09  00  00  00  1d  00  01  00  01  00  00  00  05
0000600    2a  b7  00  01  b1  00  00  00  01  00  0a  00  00  00  06  00
0000620    01  00  00  00  07  00  09  00  0b  00  0c  00  02  00  09  00
0000640    00  00  25  00  02  00  01  00  00  00  09  b2  00  02  12  03
0000660    b6  00  04  b1  00  00  00  01  00  0a  00  00  00  0a  00  02
0000700    00  00  00  09  00  08  00  0a  00  0d  00  00  00  05  01  00
0000720    0e  00  00  00  01  00  0f  00  00  00  02  00  10            
0000735
```

根据JVM规范，类文件结构如下

```java
ClassFile {
  u4               magic;
  u2               minor_version;
  u2               major_version;
  u2               const_pool_count;
  cp_info          const_pool[const_pool_count-1];
  u2               access_flags;
  u2               this_class;
  u2               super_class;
  u2               interfaces_count;
  u2               interfaces[interfaces_count];
  u2               fields_count;
  field_info       fields[fields_count];
  u2               methods_count;
  method_info      methods[methods_count];
  u2               attributes_count;
  attribute_info   attributes[attributes_count];
}
```

### 1.1 魔数

- 0-3 字节，表示它是否是【class】类型的文件

0000000    <span style='color: red'>ca  fe  ba  be</span>  00  00  00  34  00  1f  0a  00  06  00  11  09

### 1.2 版本

- 4-7 字节，表示类的版本00 34 (52) 表示是Java 8

0000000    ca  fe  ba  be  <span style='color: red'>00  00  00  34</span>  00  1f  0a  00  06  00  11  09

### 1.3 常量池

| Constant Type               | Value   |
| --------------------------- | ------- |
| CONSTANT_Class              | 7 (07)  |
| CONSTANT_Fieldref           | 9 (09)  |
| CONSTANT_Methodref          | 10 (0a) |
| CONSTANT_InterfaceMethodref | 11 (0b) |
| CONSTANT_String             | 8 (08)  |
| CONSTANT_Integer            | 3 (03)  |
| CONSTANT_Float              | 4 (04)  |
| CONSTANT_Long               | 5 (05)  |
| CONSTANT_Double             | 6 (06)  |
| CONSTANT_NameAndType        | 12 (0c) |
| CONSTANT_Utf8               | 1 (01)  |
| CONSTANT_MethodHandle       | 15 (0f) |
| CONSTANT_MethodType         | 16 (10) |
| CONSTANT_InvokeDynamic      | 18 (12) |

- 8-9 字节，表示常量池长度 00 1f (31)表示常量池有#1-#30项，注意#0项不计入，也没有值

0000000    ca  fe  ba  be  00  00  00  34 <span style='color: red'> 00  1f </span> 0a  00  06  00  11  09

- 第#1项 0a表示一个Method信息，00 06 00 11(17) 表示它引用了常量池中#6和#17项来获得这个方法的【所属类】和【方法名】

0000000    ca  fe  ba  be  00  00  00  34 00  1f  <span style='color: red'>0a  00  06  00  11</span>  09

- 第#2项09表示一个Field信息，00 12(18) 和 00 13（19）表示它引用了常量池中#18和#19项来获得这个成员变量的【所属类】和【成员变量名】

0000000    ca  fe  ba  be  00  00  00  34  00  1f  0a  00  06  00  11  <span style='color: red'> 09 </span>
0000020    <span style='color: red'>00 12 00  13</span>   08  00  14  0a  00  15  00  16  07  00  17  07

- 第#3项08表示一个字符串常量名，00 14（20）表示它引用了常量池中#20项

0000020    00 12 00  13  <span style='color: red'>08  00  14</span>  0a  00  15  00  16  07  00  17  07

- 第#4项0a表示一个Method信息，00 15（21） 和 00 16（22）表示它引用了常量池中#21和#22项来获得这个方法的【所属类】和【方法名】

0000020    00 12 00  13  08  00  14  <span style='color: red'>0a  00  15  00  16</span>  07  00  17  07

- 第#5项07表示一个Class信息，00 17（23）表示它引用了常量池中#23项

0000020    00 12 00  13  08  00  14  0a  00  15  00  16  <span style='color: red'>07  00  17</span>  07

- 第#6项07表示一个Class信息，00 18（24）表示它引用了常量池中#24项

0000020    00  12  00  13  08  00  14  0a  00  15  00  16  07  00  17  <span style='color: red'>07</span>
0000040     <span style='color: red'>00  18</span>  01  00  06  3c  69  6e  69  74  3e  01  00  03  28  29

- 第#7项01表示一个utf8串，00 06表示长度，  3c  69  6e  69  74  3e是【<init>】

0000040     00  18  <span style='color: red'>01  00  06  3c  69  6e  69  74  3e</span>  01  00  03  28  29

- 第#8项01表示一个utf8串，00 03表示长度 28 29 56是【()V】其实就是表示无参，无返回值

0000040     00  18  01  00  06  3c  69  6e  69  74  3e <span style='color: red'> 01  00  03  28  29</span>

0000060   <span style='color: red'>  56</span>  01  00  04  43  6f  64  65  01  00  0f  4c  69  6e  65  4e

- 第#9项01表示一个utf8串，00 04表示长度 43 6f 64 65是【Code】

0000060     56 <span style='color: red'> 01  00  04  43  6f  64  65</span>  01  00  0f  4c  69  6e  65  4e

- 第#10项01表示一个utf8串，00 0f（15）表示长度01   00  0f  4c  69  6e  65  4e 75  6d  62  65  72  54  61   62  6c  65是【LineNumberTable】

0000060     56 01  00  04  43  6f  64  65  <span style='color: red'> 01   00  0f  4c  69  6e  65  4e</span>

0000100    <span style='color: red'>75  6d  62  65  72  54  61   62  6c  65</span>  01  00  04  6d  61  69

- 第#11项01表示一个utf8串，00 04表示长度 6d 61 69 6e是【main】

0000100    75  6d  62  65  72  54  61   62  6c  65 <span style='color: red'> 01  00  04  6d  61  69</span>

0000120    <span style='color: red'>6e</span>  01  00  16  28  5b  4c  6a  61  76  61  2f  6c  61  6e  67

- 第#12项01表示一个utf8串，00 16(22)表示长度28  5b  4c  6a  61  76  61  2f  6c  61  6e  67 2f  53  74  72  69  6e  67  3b  29  56是【([Ljava/lang/String;)V】

0000120    6e  <span style='color: red'>01  00  16  28  5b  4c  6a  61  76  61  2f  6c  61  6e  67</span>

0000140    <span style='color: red'> 2f  53  74  72  69  6e  67  3b  29  56</span>  01  00  10  4d  65  74

- 第#13项01表示一个utf8串00 10（16）表示长度4d  65  74 68  6f  64  50  61  72  61  6d  65  74  65  72  73是【MethodParameters】

0000140    2f  53  74  72  69  6e  67  3b  29  56<span style='color: red'> 01  00  10  4d  65  74</span>  

0000160    <span style='color: red'>68  6f  64  50  61  72  61  6d  65  74  65  72  73</span>  01  00  04

- 第#14项01表示一个utf8串，00 04表示长度 61 72 67 73是【args】

0000160    68  6f  64  50  61  72  61  6d  65  74  65  72  73  <span style='color: red'>01  00  04</span>

0000200    <span style='color: red'>61  72  67  73</span>  01  00  0a  53  6f  75  72  63  65  46  69  6c

- 第#15项01表示一个utf8串，00 0a(10)表示长度53  6f  75  72  63  65  46  69  6c 65是【SourceFile】

0000200    61  72  67  73  <span style='color: red'>01  00  0a  53  6f  75  72  63  65  46  69  6c</span> 

0000220    <span style='color: red'>65</span>   01  00  0f  48  65  6c  6c  6f  57  6f  72  6c  64  2e  6a

- 第#16项01表示一个utf8串，00 0f（15）表示长度 48  65  6c  6c  6f  57  6f  72  6c  64  2e  6a  61  76  61是【HelloWorld.java】

0000220    65  <span style='color: red'>01  00   0f   48   65  6c  6c  6f  57  6f  72   6c  64  2e   6a</span> 

0000240    <span style='color: red'>61   76   61</span>   0c  00  07  00  08  07  00  19  0c  00  1a  00  1b

- 第#17项0c(12)表示一个【名+类型】，00 07 00 08表示引用了常量池中#7 #8两项

0000240    61   76   61 <span style='color: red'> 0c  00  07  00  08  </span> 07  00  19  0c  00  1a  00  1b

- 第#18项07表示一个Class信息，00 19（25）引用了常量池中#25项

0000240    61   76   61  0c  00  07  00  08 <span style='color: red'> 07  00  19 </span>  0c  00  1a  00  1b

- 第#19项0c(12)表示一个【名+类型】， 00 1a 00 1b表示引用了常量池中#26 #27两项

0000240    61   76   61  0c  00  07  00  08 07  00  19  <span style='color: red'> 0c  00  1a  00  1b </span>

- 第#20项01表示一个utf8串，00 0b(11)表示长度48  65  6c  6c  6f  20  77  6f  72  6c  64是【Hello world】

0000260   <span style='color: red'>  01  00  0b  48  65  6c  6c  6f  20  77  6f  72  6c  64</span>  07  00

- 第#21项07表示一个Class信息， 00 1c(28)引用了常量池中#28项

0000260    01  00  0b  48  65  6c  6c  6f  20  77  6f  72  6c  64  <span style='color: red'>07  00</span> 
0000300    <span style='color: red'>1c</span>   0c  00  1d  00  1e  01  00  19  63  6f  6d  2f  62  79  74

- 第#22项0c(12)表示一个【名+类型】，00 1d 00 1e表示引用了常量池中#29 #30两项

0000300    1c <span style='color: red'> 0c  00  1d  00  1e</span>   01  00  19  63  6f  6d  2f  62  79  74

- 第#23项01表示一个utf8串，00 19（25）表示长度，表示【com/bytebuf/t2/HelloWorld】

0000300    1c 0c  00  1d  00  1e <span style='color: red'> 01  00  19  63  6f  6d  2f  62  79  74</span> 
0000320    <span style='color: red'>65  62  75  66  2f  74  32  2f  48  65  6c  6c  6f  57  6f  72</span> 
0000340   <span style='color: red'> 6c  64</span>    01  00  10  6a  61  76  61  2f  6c  61  6e  67  2f  4f

- 第#24项01表示一个utf8串，00 10（16）表示长度6a  61  76  61  2f  6c  61  6e  67  2f  4f  62  6a  65  63  74是【java/lang/Object】

0000340   6c  64  <span style='color: red'> 01  00  10  6a  61  76  61  2f  6c  61  6e  67  2f  4f</span> 

0000360   <span style='color: red'>62  6a  65  63  74</span>   01  00  10  6a  61  76  61  2f  6c  61  6e

- 第#25项01表示一个utf8串，00 10（16）表示长度6a  61  76  61  2f  6c  61  6e  67  2f  53  79  73 74  65  6d是【java/lang/System】

0000360   62  6a  65  63  74  <span style='color: red'>01  00  10  6a  61  76  61  2f  6c  61  6e</span> 

0000400   <span style='color: red'>67  2f  53  79  73 74  65  6d </span> 01  00  03  6f  75  74  01  00

## 2. 字节码指令

## 3. 编译期处理

## 4. 类加载阶段

## 5. 类加载器

## 6. 运行期优化

