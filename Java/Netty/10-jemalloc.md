# 背景知识

- jemalloc由Jason Evans在FreeBSD项目中引入的新一代内存分配器。它是一个通用的malloc实现，侧重于减少内存碎片和提升高并发场景下内存的分配效率，其目标是能够替代malloc
- ptmalloc基于glibc实现的内存分配器，它是一个标准实现，所以兼容性好。pt表示per thread的意思，当然ptmalloc确实在多线程的性能优化上下了很多功夫，由于过于考虑性能问题，多线程之间内存无法实现共享，只能每个线程都独立使用各自的内存，所以在内存开销上是有很大浪费的
- tcmalloc出身于Google,全称是thread-caching malloc所以tcmalloc最大的特点是带有线程缓存
  - 对于小对象的分配，可以直接由线程局部缓存来完成
  - 对于大对象的分配场景，tcmalloc尝试采用自旋锁来减少多线程的锁竞争问题
- Jemalloc借鉴了tcmalloc优秀的设计思路，同样都包含thread cache的特性
  - jemalloc将内存分配粒度划分为small, large, huge三个分类并记录了很多meta数据，所以在空间占用上要略多于tcmalloc
  - tcmalloc内部采用红黑树管理内存块和分页，huge对象通过红黑树查找索引数据可以控制在指数级时间
- 核心目标
  - 高效的内存分配和回收，提升单线程或者多线程场景下的性能
  - 减少内存碎片，包括内部碎片和外部碎片，提高内存的有效利用率
- 什么是内存碎片
  - Linux中物理内存会被划分成若干个4K大小的内存页Page，物理内存的分配和回收都是基于Page完成的
  - Page内产生的内存碎片称为内部碎片
  - Page之间产生的内存碎片称为外部碎片

# 常用的内存分配器算法

## 动态内存分配

- 动态内存分配(Dynamic memory allocation)又称为堆内存分配，后面简称DMA操作系统根据运行过程中的需求即时分配内存，且分配的内存大小就是程序需求的大小
- DMA是从一整块内存中按需分配，对于分配出的内存会记录元数据，同时还会使用空闲分区维护空闲内存，便于在内存分配时查找可用的空闲分区

### 首次适应算法(first fit)

- 空闲分区链以地址递增的顺序将空闲分区以双向链表的形式连接在一起，从空闲分区链中找到第一个满足分配条件的空闲分区，然后从空闲分区中划分出一块可用内存给请求进程，剩余的空闲分区仍然保留在空闲分区链中

## 伙伴算法

## slab算法

