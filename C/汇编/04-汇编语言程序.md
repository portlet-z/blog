## 由源程序到程序运行

- 程序员 -> 汇编程序 -> 编译器 -> 机器码 -> 计算机执行
- 汇编指令：对应有机器码的指令，可以被编译为机器指令，最终被CPU执行
- 伪指令：没有对应的机器码指令，最终不被CPU所执行
- 谁来执行伪指令：伪指令是由编译器来执行的指令，编译器根据伪指令来进行相关的编译工作
- 程序返回（套路）：程序结束运行后，将CPU的控制权交还给使他得以运行的程序（常为DOS系统）

```assembly
assume cs:codesg
codesg segment
	mov ax, 0123H
	mov bx, 0456H
	add ax, bx
	add ax, ax
	
	mov ax, 4c00H
	int 21h
codesg ends
end
```

### 程序中的三种伪指令

- 段定义

  - 一个汇编程序是由多个段组成的，这些段被用来存放代码，数据或当作栈空间来使用
  - 一个有意义的汇编程序中至少要有一个段，这个段用来存放代码
  - 定义程序中的段：每个段都需要有段名

  ```assembly
  段名 segment -- 段的开始
  ......
  段名 ends -- 段的结束
  ```

- end(不是ends):汇编程序的结束标记。若程序结尾处不加end, 编译器在编译程序时，无法知道程序在何处结束

- assume(假设)：含义是假设某一段寄存器和程序中的某一个用segment...ends定义的段相关联--assume cs:codesg 指CS寄存器与codesg关联，将定义的codesg当作程序的代码段使用

### 汇编程序的结构

- 在debug中直接写入指令编写的汇编程序
  - 适用于功能简单，短小精悍的程序
  - 只需要包含汇编指令即可
- 单独编写成源文件后再编译为可执行文件的程序
  - 适用于编写大程序
  - 需要包括汇编指令，还要有指导编译器工作的伪指令
  - 源程序由一些段构成，这些段存放代码，数据，或将某个段当作栈空间
- ; 注释

```assembly
assume cs:code ds:data ss:stack
data segment
	dw 0123H, 0456H, 0789H, 0abcH, 0defH
data ends
stack segment
	dw 0,0,0,0,0,0,0,0,0,0,0,0,0,0
stack ends
code segment
	mov ax, stack
	mov ss, ax
	mov sp, 20H
	mov ax, data
	mov ds, ax
	mov bx, 0
	mov cx, 8
 s: push [bx]
 	add bx, 2
 	loop s
 	
 	mov ax, 4c00H
 	int 21h
code ends
end
```

### 如何写出一个程序来

- 例：编程求2^3

1. 定义一个段

  ```assembly
  abc segment
  abc ends
  ```

2. 实现处理任务

```assembly
abc segment
	mov ax, 2
	add ax, ax
	add ax, ax
abc ends
```

3. 指出程序在何处结束

```assembly
abc segment
	mov ax, 2
	add ax, ax
	add ax, ax
abc ends
end
```

4. 段与段寄存器关联

```assembly
assume cs:abc
abc segment
	mov ax, 2
	add ax, ax
	add ax, ax
abc ends
end
```

5. 加上程序返回的代码

```assembly
assumen cs:abc
abc segment
	mov ax, 2
	add ax, ax
	add ax, ax
	
	mov ax, 4c00H
	int 21h
abc ends
end
```

### 程序中可能的错误

- 语法错误：程序在编译时被编译器发现的错误
- 逻辑错误：程序在编译时不能表现出来的，在运行时发生的错误

### 由源程序到程序运行

- 源程序文件.asm --编译--> 目标文件.obj --连接--> 可执行文件.exe --运行-->计算机

#### 编译

- 目标文件(*.obj)是我们对一个源程序进行编译要得到的最终结果
- 列表文件(*.lst)是编译器将源程序编译为目标文件的过程中产生的中间结果
- 交叉引用文件(*.crf)同列表文件一样，是编译器将源程序编译为目标文件过程中产生的中间结果
- 对源程序的编译结束，编译器输出的最后两行告诉我们这个源程序没有警告错误和必须要改正的错误
- 命令后加;以简化过程

```
masm p4-1.asm 
masm p4-1.asm;
```

#### 连接

- 可以执行文件(*.exe)是我们对一个程序进行连接要得到的最终结果
- 映像文件(*.map)是连接程序将目标文件连接为可执行文件过程中产生的中间结果
- 库文件(*.lib)里包含了一些可以调用的子程序，如果我们的程序中调用了某一个库文件中的子程序，就需要在连接的时候，将这个库文件和我们的目标文件连接到一起，生成可执行文件
- no stack segment, 一个没有栈段的警告错误，可以不用理会

```
link p4-1;
```

#### 提示语法错误

- Serve Errors
- 找不到所给出的源程序文件

## 用Debug跟踪程序的执行



## [...]和(...)

## Loop指令

## 段前缀

## 在代码段中使用数据

## 在代码段中使用栈

## 将数据，代码，栈放入不同段

