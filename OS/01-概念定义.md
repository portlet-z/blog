## 定义

- 操作系统(Operation System, OS)是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源分配，以提供给用户和其他软件方便的接口和环境，它是计算机系统中最基本的系统软件
- 直观的例子：打开Windows操作系统的任务管理器(Ctrl + Alt + Del)



## 功能和目标

- 作为系统资源的管理者
  - 提供的功能：处理机管理，存储器管理，文件管理，设备管理
  - 目标：安全高效
  - 补充知识：进程是一个程序的执行过程。执行前需要将该程序放到内存中，才能被CPU处理
  - 用QQ和朋友视频聊天的过程
    1. 在各个文件夹中找到QQ安装的位置(如D:/Tencent/QQ/Bin):逐层打开文件夹，找到QQ.exe这个程序（可执行文件）的存放位置
    2. 双击打开QQ.exe:需要把该程序相关数据放入内存
    3. QQ程序正常运行：对应的进程被处理机(CPU)处理
    4. 开始和朋友视频聊天：需要将摄像头设备分配给进程
- 作为用户和计算机硬件直接的接口
  - 提供的功能：命令接口：允许用户直接使用，程序接口：允许用户通过程序间接使用，GUI：现代操作系统中最流行的图形用户接口
  - 目标：方便用户使用



## 特征

- 并发：指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的。并行：只两个或多个事件在同一时刻发生
- 共享：即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用
  - 互斥共享方式：系统中的某些资源，虽然可以提供给多个进程使用，但一个时间段内只允许一个进程访问该资源
  - 同时共享方式：系统中的某些资源，允许一个时间段内由多个进程”同时“对它们进行访问
- 并发和共享的关系：
  - 并发性值计算机系统中同时存在着多个运行着的程序
  - 共享性是指系统中的资源可供内存中多个并发执行的进程共同使用
  - 如果失去并发性，则系统中只有一个程序正在运行，则共享性失去存在的意义
  - 如果失去共享性，则QQ和微信不能同时访问硬盘资源，就无法实现同时发送文件，也就无法并发
- 虚拟：是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的。
  - 空分复用技术：32位的操作系统每个程序的逻辑寻址都是4GB,但是电脑只有2GB的物理空间
  - 时分复用技术：微观上处理机在各个微小的时间段内交替着为各个进程服务
- 异步：是指在多道程序环境下，允许多个程序并发执行，但由于系统资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。显然，如果失去了并发性，则系统只能串行地处理各个进程，每个进程的执行会一贯到底。只有系统拥有并发性，才有可能导致异步性



## 发展与分类

#### 手工操作阶段

#### 批处理阶段

- 单批道处理系统
  - 引入脱机输入输出技术（用磁带完成），并监督程序（操作系统的雏形）负责控制作业的输入输出
  - 优点：缓解了一定程度的人机速度矛盾，资源利用率有所提升
  - 缺点：内存中仅能有一道程序运行，只有该程序运行结束之后才能调入下一道程序。CPU有大量的时间是在空闲等待I/O完成。资源利用率很低
- 多批道处理系统
  - 每次往内存中输入多道程序。操作系统正式诞生，并引入了中断技术，由操作系统负责管理这些程序的运行。各个程序并发执行
  - 优点：多道程序并发执行，共享计算机资源。资源利用率大幅提升，CPU和其他资源保持忙碌状态，系统吞吐量增大
  - 缺点：用户响应时间长，没有人机交互功能（用户提交自己的作业之后就只能等待计算机处理完成，中间不能控制自己的作业执行）

#### 分时操作系统

- 计算机以时间片为单位轮流为各个用户作业服务，各个用户可通过终端与计算机进行交互。
- 优点：用户请求可以被及时响应，解决了人机交互问题。允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在
- 缺点：不能优先处理一些紧急任务。操作系统对各个用户作业都是完全公平的，循环地为每个用户作业服务一个时间片，不区分任务的紧急性

#### 实时操作系统

- 优点：能够优先响应一些紧急任务，某些紧急任务不需时间片排队
- 在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格的时限内处理完事件。实时操作系统的主要特点是及时性和可靠性
- 硬实时系统：必须在绝对严格的规定时间内完成处理。如导弹控制系统，自动驾驶系统
- 软实时系统：能接受偶尔违反时间规定。如12306火车订票系统

#### 网络操作系统

- 是伴随着计算机网络发展而诞生的，能把网络中各个计算机有机地结合起来，实现数据传送等功能，实现网络中各种资源的共享（如文件共享）和各台计算机之间的通信（如：Windows NT就是一种典型的网络操作系统，网站服务器就可以使用）

#### 分布式操作系统

- 主要特点是分布性和并行性。系统中的个台计算机地位相同，任何工作都可以分布在这些计算机上，由它们并行，协同完成这个任务

#### 个人计算机操作系统

- Windows, MacOS



## 运行机制和体系结构

#### 运行机制

- 两种指令
  - 特权指令：如内存清零指令（不允许用户操作）
  - 非特权指令：如普通的运算指令
- 两种处理器状态
  - 用户态（目态）：此时CPU只能执行非特权指令
  - 核心态（管态）：特权指令，非特权指令都可执行
  - 用户程序状态字寄存器PSW中的某标志位来标识当前处理器处于什么状态。如0位用户态，1为核心态
- 两种程序
  - 内核程序：操作系统的内核程序是系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在核心态
  - 应用程序：为了保证系统能安全运行，普通应用程序只能执行非特权指令，运行在用户态

#### 操作系统内核

- [计算机层次结构](#https://www.processon.com/view/link/61f24a6f6376890390ca0202)

- 时钟管理
- 中断处理
- 原语
- 对系统资源进行管理的功能

#### 体系结构

- 大内核
  - 将操作系统的主要功能模块都作为系统内核，运行在核心态
  - 优点：高性能
  - 缺点：内核代码庞大，结构混乱，难以维护
- 微内核
  - 只把最基本的功能保留在内核
  - 优点：内核功能少，结构清晰，方便维护
  - 缺点：需要频繁地在核心态和用户态之间切换，性能低



##中断和异常

#### 中断机制的诞生

- 本质：发送中断就意味着需要操作系统介入，开展管理工作

#### 中断的概念和作用

- 当中断发生时，CPU立即进入核心态
- 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理
- 对于不同的中断信号，会进行不同的处理
- 发生了中断，就意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配I/O设备等）需要使用特权指令，因此CPU要从用户态转为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权。有了中断，才能实现多道程序并发执行
- 用户态->核心态是通过中断实现的，并且中断是唯一途径。核心态->用户态的切换是通过执行一个特权指令，将程序状态字PSW的标志位设置为用户态

#### 中断的分类

- 内中断（异常，例外，陷入）：信号的来源，CPU内部与当前执行的指令有关
  - 分类方式1：
    - 陷阱，陷入(trap):有意为之的异常，如系统调用
    - 故障(fault):由错误条件引起的，可能被故障处理程序修复，如缺页
    - 终止(abort):不可恢复的致命错误造成的结果，终止处理程序不再将控制返回给引发终止的应用程序，如整数除0
  - 分类方式2：
    - 自愿中断（指令中断）：如系统调用时使用的访管指令（又叫陷入指令，trap指令）
    - 强迫中断：硬件故障（如缺页）；软件中断（如整数除0）
- 外中断：信号的来源，CPU外部与当前执行的指令无关
  - 外设请求：如I/O操作完成发出的中断信号
  - 人工干预：如用户强行终止一个进程

#### 外中断的处理过程 

- 执行完每个指令之后，CPU都要检查当前是否有外部中断信号
- 如果检测到外部中断信号，则需要保护被中断进程的CPU环境（如程序状态字PSW、程序计数器PC、各种通用寄存器）
- 根据中断信号类型转入相应的中断处理程序
- 恢复原进程的CPU环境并退出中断，返回原进程继续往下执行











