### 概述

#### 分层

- 链路层：处理与电缆(或其他任何传输媒介)的物理接口细节
- 网络层：处理分组在网络中的活动，例如分组选路
- 运输层：为两台主机上的应用程序提供端到端的通讯
- 应用层：处理特定的应用程序细节



- 大多数的网络应用程序都被设计成客户-服务器模式
- 双方都有对应的一个或多个协议进行通讯
- 应用程序通常是用户进程，而下三层一般在内核执行
- 应用层关心应用程序的细节，下三层处理通讯细节

#### 通过路由器链接的两个网络

- 端系统 end system
- 中间系统 intermediate system
- 应用层和运输层使用端到端 end-to-end 协议
- 网络层提供的是逐跳 hop-to-hot 协议
- 网络 ip 提供的是一种不可靠的服务，他只是尽可能的把分组从源节点送到目的节点，但不提供可靠性保障
- TCP 在不可靠的 IP层上提供一个可靠的运输层
- 互联网的目的之一就是在应用程序中隐藏所有的物理细节

#### TCP/IP 协议族中不同层次的协议

- TCP 使用不可靠的 IP 服务，并提供一种可靠的运输层服务
- UPD 为应用程序发送和接受数据报，和 TCP 不同的，UDP 是不可靠的
- IP 是网络层上的主要协议，同事被 TCP 和 UDP 使用
- ICMP 是 IP 协议复数协议

#### 封装

- 以太网数据帧的物理特性是其长度必须在46-1500字节之间
- 以太网的帧首部也有一个16bit 的帧类型域 ip,arp,rarp
- IP 在首部中存入一个长度为8bit 的数值，称作协议域 icmp,igmp,tcp,udp,esp,gre
- TCP 和 UDP 都用一个16bit 的端口号来表示不同的应用程序 ftp,telnet,http

#### 端口号

- 服务器一般都是通过知名端口号来识别的 ftp:21, telnet:23
- 客户端口号又称临时端口号即存在时间很短
- 大多数 TCP/IP 实现给临时端口分配1024-5000之间的端口号
- 大于5000的端口号是为其他服务器预留的 Internet 上并不常用的服务



### 链路层

#### 以太网

- 以太网这个术语一般是指数字设备公司 Digital Equipment Corp，英特尔公司 IntelCorp和 Xerox 公司在1982年联合公布的一个标准
- 它采用一种称作 CSMA/CD 的媒体接入方法 Carrier Sense, Multiple Access with Collision Detection
- 它的速率为10Mb/s,地址为48bit

#### IEEE802封装

- 802.3针对整个 CSMA/CD 网络
- 802.4针对令牌总线网络
- 802.5针对令牌环网络
- 这三者的共同特性由802.2标准来定义，那就是802网络共有的逻辑链路控制 LLC

#### 环回接口

- 传给环回地址一般是127.0.0.1的任何数据均作为 IP 输入
- 传给广播地址或多播地址的数据报复制一份传给环回接口，然后送到以太网上。这是因为广播传送和多播传送的定义包含主机本身
- 任何传给该主机 IP 地址的数据均送到环回接口

#### MTU 和路径 MTU

- 以太网和802.3对数据帧的长度都有一个限制，其最大值分别是1500和1492字节。链路层的这个特性称作 MTC，最大传输单元
- 如果 IP 层有一个数据报要传，而且数据的长度比链路层的 MTU 还大，那么 IP 层就需要进行分片 fragementation,把数据报分成若干片，这样每一片都小于 MTU
- 点到点的链路层如 SLIP 和 PPP 的 MTC 并非指的是网络媒体的物理特性。相反，它是一个逻辑限制，目的是为交互使用提供足够快的响应时间
- 两台通信主机路径中的最小 MTU 它被称作路径 MTU
- 路径 MTU 在两个方向上不一定是一致的
- MTU 是计算出方向



### IP

#### IP 介绍

- IP 是 TCP/IP 协议族中最为核心的协议。所有的 TCP,UDP,ICMP 和 IGMP 数据都以 IP 数据报格式传输
- IP 提供不可靠、无连接的数据报传送服务
- 不可靠 unreliable 的意思是它不能保证 IP 数据报能成功地到达目的地。IP 仅能提供最好的传输服务。如果发生某种错误时，如某个路由器暂时用完了缓冲区，IP 有一个简单的错误处理算法：丢弃该数据报，然后发送 ICMP 消息报给信源端。任何要求的可靠性必须由上层来提供 如 TCP
- 无连接 connectionless 这个术语的意思是 IP 并不维护任何关于后续数据报的状态信息。每个数据报的处理是相互独立的。IP 数据报可以不按发送顺序接收。如果一信源的向相同的信宿发送两个连续的数据报先是 A 然后是 B，每个数据报都是独立地进行路由选择，可能选择不同的路线，因此 B 可能在 A到达之前先到达
- 两个有用的命令：ifconfig 和 netstat



### ARP

- 当一台主机把以太网数据帧发送到位于同一局域网上的另一台主机时，是根据48bit 的以太网地址来确定目的接口的。设备驱动程序从不检查 IP 数据报中的目的 IP 地址
- 地址解析为这两种不同的地址形式提供映射：32bit 的 IP 地址和数据链路层使用的任何类型的的地址
- ARP 为 IP 地址对应的硬件地址之间提供动态映射。我们之所以用动态这个词是因为这个过程是自动完成的，一般应用程序用户或系统管理员不必关心
- RARP 是被那些没有磁盘驱动器的系统使用(一般是无盘工作站或 X 终端)，它需要系统管理员进行手工设置