# 以太网协议
- 以太网协议是现代计算机网络中最常用的局域网(LAN)技术之一，它定义了数据链路层和物理层的规则，用于实现设备之间的数据传输。以下是对以太网协议的详细介绍：
## 以太网的基本概念
- 定义：以太网是一组技术和协议的集合，主要由IEEE制定，标准为IEEE802.3
- 目标：在局域网环境中实现可靠、高效的数据通信
- 应用场景：办公网络、家庭网络、数据中心、工业网络等
## 以太网的结构和原理
- 以太网协议规定了数据在网络中的封装格式和传输方式，包括以下几个核心部分：
### 以太网帧结构
- 以太网使用帧(Frame)来封装和传输数据。标准以太网帧的格式如下

|字段|长度|说明|
|-|-|-|
|前导码|7字节|同步信号，帮助接收设备锁定帧的起始位置|
|帧起始定界符(SFD)|1字节|标记帧的开始，通常是10101011|
|目标MAC地址|6字节|数据帧的接收方MAC地址|
|源MAC地址|6字节|数据帧的发送方MAC地址|
|以太类型/长度|2字节|数据帧的类型（如IPv4,IPv6）或帧的长度|
|数据/填充|46-1500字节|实际数据负载，若不足46字节需填充|
|帧校验序列(FCS)|4字节|用于检测帧传输中的错误|

### MAC地址
- 每个以太网设备都有一个唯一的MAC地址，通常由6字节(48位)组成
- 前3字节：厂商标识(OUI,Organizationally Unique Identifier)
- 后3字节：厂商分配的设备标识
### 数据传输原理
- 介质访问控制(MAC):
    - 以太网采用CSMA/CD(载波监听多路访问/碰撞检测)技术：
    - 设备监听共享信道
    - 如果信道空闲，设备开始发送数据
    - 如果检测到碰撞（多设备同时发送数据），停止发送并随机等待后重试
    - 现代以太网中（如全双工模式和交换式网络），已基本 无需CSMA/CD
- 帧校验：帧校验序列(FCS)采用循环冗余校验(CRC)算法，接收方通过校验确保数据帧的完整性
## 以太网的主要特性
- 传输速率：初期速率位10Mbps,发展到100Mbps(Fast Ethernet), 1Gbps(Gigabit Ethernet),目前主流支持10Gbps, 40Gbps和100Gbps
- 传输介质：支持双绞线(UTP),光纤，同轴电缆等多种介质
- 拓扑结构：典型结构位星型拓扑（使用交换机连接多个设备）
- 全双工模式：支持全双工通信（同时收发数据），提高了效率
## 以太网的工作方式
- 以太网的工作涉及多个层面的标准和协议
- 物理层：定义传输介质和物理信号（如电压、电流、波长）
- 数据链路层：包括MAC子层和LLC子层，负责帧的封装和介质的访问控制
## 以太网的优点
- 易用性：安装简单，易于配置和维护
- 兼容性：支持多种传输介质和设备
- 高性价比：硬件成本低、技术成熟
- 灵活性：可以适应不同规模的网络需求
## 以太网的局限性
- 距离限制：受传输介质的物理限制，传输距离有限
- 共享带宽：早期以太网设备在共享介质下，容易产生冲突和拥塞
- 实时性不足：不适合对延迟要求严格的场景
## 以太网的反转
- 经典以太网(10Mbps):最初采用同轴电缆
- 快速以太网(100Mbps):引入双绞线和交换式网络
- 千兆以太网(1Gbps):支持高速通信，广泛用于企业和数据中心
- 万兆以太网(10Gbps):用于高性能计算和存储网络
- 下一代以太网(40/100Gbps):适用于超大规模数据中心和骨干网
## 以太网在现代网络中的地位
- 以太网凭借其高性能，低成本和广泛兼容性，已成为局域网和数据中心网络的主流选择。通过不断的技术创新，未来的以太网将支持更高的速率，更低的延迟，并且更加适应云计算和物联网的发展需求
## 数据包结构
- 以太网帧头(Ethernet Frame Header)是以太网通信中用于传输数据的一个重要结构。标准以太网帧头的长度是14字节，其结构如下
### 目标MAC地址(Destination MAC Address, 6字节)
- 表示数据包的接收者的MAC地址
- 用于标识以太网网络中的目标设备
### 源MAC地址(Source MAC Address, 6字节)
- 表示发送者的MAC地址
- 用于表示发送数据的设备
### 类型/长度字段(Type/Length, 2字节)
- 类型字段(Type):标识数据部分使用的协议(IP,ARP等)，以16进制表示
- 0x0800: IPv4, 0x0806: ARP, 0x86DD: IPv6
- 长度字段(Length): 在某些情况下可以表示数据的长度，适用于IEEE 802.3标准
## 以太网帧头后的内容
- 帧头后面是数据负载部分和帧尾
- 数据负载(Payload): 46-1500字节，包括实际传输的数据
- 帧校验序列(FCS, Frame Check Sequence):4字节，用于检测数据传输过程中的错误
## 总结
- 标准以太网帧的总长度64-1518字节
- 帧头：14字节
- 数据负载：46-1500字节
- FCS: 4字节
- 如果启用了802.1Q VLAN标记，则帧头会增加4字节，用于存储VLAN信息，变为18字节

# 字节序
- 字节序(Endianness)是计算机系统中多字节数据在内存中存储顺序的约定。它决定了数据的高位字节和低位字节在存储时的排列方式
## 大端字节序(Big-endian)
- 高位字节存储在低地址，低位字节存储在高地址
- 类比：类似于我们日常阅读的书写顺序（从左到由，高位先出现）
- 示例：假设一个32位整数0x12345678: 内存地址从低到高依次为: 12 34 56 78
```
地址: 0x00 0x01 0x02 0x03
数据:  12   34   45   78
```
## 小端字节序(Little-endian)
- 低位字节存储在低地址，高位字节存储在高地址
- 类比：类似于倒读（从右到左，低位先出现）
- 示例：假设一个32位整数0x12345678: 内存地址从低到高依次为：78 56 34 12
```
地址: 0x00 0x01 0x02 0x03
数据:  78   56   34   12
```
## 字节序影响范围
- 网络传输：网络字节序通常采用大端字节序。在传输数据时，需要将数据转换为统一的字节序，发送方和接收方必须约定一致
- 文件存储：文件格式如BMP, WAV, JPEG等会规定文件中的字节序
- 跨平台开发：不同平台可能右不同的字节序（x86是小端序，部分嵌入式系统或网络协议是大端序）
## 常见处理字节序的函数
- 在C语言中，可以使用以下函数处理字节序
- htonl/htons: 主机字节序转换为网络字节序(主机到网络)l(long),s(short)
- ntohl/ntohs: 网络字节序转换为主机字节序(网络到主机)
## 总结
- 字节序是数据在存储或传输中的排列顺序，分为大端和小端
- 对于跨平台、网络通信和文件处理，理解字节序非常重要
- 在编程中要小心字节序的隐式影响，确保数据的正确性和一致性